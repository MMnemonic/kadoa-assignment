@tailwind base;
@tailwind components;
@tailwind utilities;

/* Kadoa variables — light defaults */
:root {
	/* Light theme tuned for contrast */
	--bg-canvas: 236 238 242;   /* slightly darker to increase contrast */
	--bg-surface: 255 255 255;  /* tiles/panels remain pure white */
	--bg-subtle: 241 243 245;   /* used for active pill bg etc. */
	--border: 212 217 223;      /* visible light border */
	--text: 29 31 36;           /* ~#1d1f24 */
	--text-muted: 100 110 121;  /* ~#646e79 */
	--accent: 249 115 22;
	--accent-600: 234 88 12;
	--chip-info: 59 130 246;
	/* gentler light chip backgrounds for contrast on white */
	--chip-warn-bg: 255 247 232; /* #fff7e8 */
	--chip-warn-text: 180 83 9;
	--chip-crit-bg: 255 237 238; /* #ffedee */
	--chip-crit-text: 190 60 60;
}

.dark:root {
	--bg-canvas: 15 15 17;
	--bg-surface: 24 24 27;
	--bg-subtle: 18 18 20;
	--border: 39 39 42;
	--text: 244 244 245;
	--text-muted: 161 161 170;
	--accent: 249 115 22;
	--accent-600: 234 88 12;
	--chip-info: 96 165 250;
	--chip-warn-bg: 46 32 17;
	--chip-warn-text: 245 158 11;
	--chip-crit-bg: 50 18 18;
	--chip-crit-text: 248 113 113;
}

/* Canvas */
body { @apply bg-[rgb(var(--bg-canvas))] text-[rgb(var(--text))]; }

/* Subtle geometric background (triangles) on canvas wrapper */
.app-bg { @apply bg-kadoa-pattern; }
.kd-bg {
	/* two layers of triangular grids at different scales */
	background-image:
		linear-gradient(135deg, rgba(0,0,0,0.02) 25%, transparent 25%),
		linear-gradient(225deg, rgba(0,0,0,0.02) 25%, transparent 25%),
		linear-gradient(45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
		linear-gradient(315deg, rgba(0,0,0,0.02) 25%, rgba(0,0,0,0.02) 25%),
		linear-gradient(135deg, rgba(0,0,0,0.01) 25%, transparent 25%),
		linear-gradient(225deg, rgba(0,0,0,0.01) 25%, transparent 25%),
		linear-gradient(45deg, rgba(0,0,0,0.01) 25%, transparent 25%),
		linear-gradient(315deg, rgba(0,0,0,0.01) 25%, rgba(0,0,0,0.01) 25%);
	background-position:
		20px 0, 20px 0, 0 0, 0 0,
		80px 0, 80px 0, 60px 0, 60px 0;
	background-size:
		40px 40px, 40px 40px, 40px 40px, 40px 40px,
		160px 160px, 160px 160px, 160px 160px, 160px 160px;
	background-repeat: repeat;
}
.dark .kd-bg {
	background-image:
		linear-gradient(135deg, rgba(255,255,255,0.04) 25%, transparent 25%),
		linear-gradient(225deg, rgba(255,255,255,0.04) 25%, transparent 25%),
		linear-gradient(45deg, rgba(255,255,255,0.04) 25%, transparent 25%),
		linear-gradient(315deg, rgba(255,255,255,0.04) 25%, rgba(255,255,255,0.04) 25%),
		linear-gradient(135deg, rgba(255,255,255,0.02) 25%, transparent 25%),
		linear-gradient(225deg, rgba(255,255,255,0.02) 25%, transparent 25%),
		linear-gradient(45deg, rgba(255,255,255,0.02) 25%, transparent 25%),
		linear-gradient(315deg, rgba(255,255,255,0.02) 25%, rgba(255,255,255,0.02) 25%);
	background-position:
		20px 0, 20px 0, 0 0, 0 0,
		80px 0, 80px 0, 60px 0, 60px 0;
	background-size:
		40px 40px, 40px 40px, 40px 40px, 40px 40px,
		160px 160px, 160px 160px, 160px 160px, 160px 160px;
	background-repeat: repeat;
}

@layer components {
	/* Surfaces & cards */
	.ui-surface { @apply bg-[rgb(var(--bg-surface))] border border-[rgb(var(--border))] dark:border-white/10 rounded-xl shadow-elev-1; }
	.ui-card    { @apply ui-surface p-4; }
	/* Light-only translucency for generic cards */
	.ui-card { background-color: rgb(var(--bg-surface) / 0.8); }
	.dark .ui-card { background-color: rgb(var(--bg-surface)); }
	.ui-card-hover { @apply transition-all duration-150 hover:shadow-elev-2 hover:-translate-y-0.5 hover:ring-1 hover:ring-[rgb(var(--accent))] hover:border-transparent focus-within:ring-1 focus-within:ring-[rgb(var(--accent))]; }

	/* Buttons */
	.ui-btn { @apply inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm border border-[rgb(var(--border))] dark:border-white/10 bg-[rgb(var(--bg-surface))] hover:bg-[rgb(var(--bg-subtle))] transition; }
	.ui-btn--primary { @apply bg-[rgb(var(--accent))] text-white border-transparent hover:bg-[rgb(var(--accent-600))]; }
	/* Ghost buttons: light = crisp text + subtle bg; dark remains the same */
	.ui-btn--ghost {
		@apply rounded-xl px-3 py-2
			border border-[rgb(var(--border))]
			bg-[rgb(var(--bg-surface))] hover:bg-[rgb(var(--bg-subtle))]
			text-[rgb(var(--text))]
			dark:border-white/10 dark:bg-white/5 dark:hover:bg-white/[.08] dark:text-white/90;
	}
	/* Icon buttons inherit the ghost treatment for light; keep dark as-is */
	.ui-iconbtn {
		@apply ui-btn p-2; border-radius: 10px;
		@apply text-[rgb(var(--text-muted))] hover:text-[rgb(var(--text))] dark:text-white/80;
	}
	.focus-ring { @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500/60; }

	/* Badges / chips */
	.ui-chip { @apply inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs border; }
	.ui-chip--info { @apply border-transparent bg-blue-50 text-blue-700 dark:bg-blue-500/10 dark:text-blue-300; }
	.ui-chip--warn { background-color: rgb(var(--chip-warn-bg)); color: rgb(var(--chip-warn-text)); border-color: rgb(var(--chip-warn-text)); }
	.ui-chip--crit { background-color: rgb(var(--chip-crit-bg)); color: rgb(var(--chip-crit-text)); border-color: rgb(var(--chip-crit-text)); }

	/* Group header labels inside list (Today/Yesterday/Earlier) */
	.group-header {
		@apply px-4 py-1 text-xs font-medium tracking-wide
			text-[rgb(var(--text-muted))] dark:text-white/60;
	}

	/* Segmented control: clear contrast in light, unchanged in dark */
	.ui-seg {
		@apply inline-flex items-center rounded-xl
			border border-[rgb(var(--border))]
			bg-[rgb(var(--bg-surface))] p-0.5
			dark:border-white/10;
	}
	.ui-segitem {
		@apply px-3 h-9 inline-flex items-center rounded-lg text-sm
			text-[rgb(var(--text-muted))]
			data-[active=true]:text-[rgb(var(--text))]
			data-[active=true]:bg-[rgb(var(--bg-subtle))];
	}

	/* KPI tiles */
	.ui-kpi { @apply ui-card flex items-center justify-between; }
	.ui-kpi__value { @apply text-2xl font-semibold tracking-tight; }
	.ui-kpi__delta--up { @apply inline-flex items-center gap-1 rounded-full bg-green-50 text-green-700 px-2 py-0.5 text-xs border border-green-200 dark:bg-green-500/10 dark:text-green-300 dark:border-green-900; }
	.ui-kpi__delta--down { @apply inline-flex items-center gap-1 rounded-full bg-red-50 text-red-700 px-2 py-0.5 text-xs border border-red-200 dark:bg-red-500/10 dark:text-red-300 dark:border-red-900; }

	/* Inputs: stronger border + readable placeholder in light */
	.ui-field {
		@apply rounded-lg border border-[rgb(var(--border))] dark:border-white/10
			bg-[rgb(var(--bg-surface))] px-3 py-2 text-sm
			outline-none focus:ring-2 ring-[rgb(var(--accent))]
			placeholder:text-[rgb(var(--text-muted))];
	}

	/* Sticky toolbar wrapper */
	.ui-sticky { @apply sticky top-[64px] z-30; }
	.toolbar { @apply ui-card p-3; }
	.toolbar[data-scrolled='true'] { @apply shadow-elev-1; }

	/* Static group header handled above */

	/* --- Glass containers (near solid, no blur) --- */
	.ui-glass { @apply rounded-2xl border shadow-elev-1 backdrop-blur-none; background-color: rgb(var(--bg-surface) / 0.7); border-color: rgb(var(--border)); }
	.dark .ui-glass { background-color: rgb(var(--bg-surface) / 0.8); }
	.ui-glass-strong { @apply rounded-2xl border shadow-elev-2 backdrop-blur-none; background-color: rgb(var(--bg-surface) / 0.7); border-color: rgb(var(--border)); }
	.dark .ui-glass-strong { background-color: rgb(var(--bg-surface) / 0.8); }
	/* Ensure translucency wins when both classes are present */
	.ui-card.ui-glass { background-color: rgb(var(--bg-surface) / 0.7); }
	.dark .ui-card.ui-glass { background-color: rgb(var(--bg-surface) / 0.8); }
	.ui-card.ui-glass-strong { background-color: rgb(var(--bg-surface) / 0.7); }
	.dark .ui-card.ui-glass-strong { background-color: rgb(var(--bg-surface) / 0.8); }
	/* Force light-mode translucency even if utility classes override */
	:root .ui-card.ui-glass, :root .ui-card.ui-glass-strong, :root .ui-glass, :root .ui-glass-strong { background-color: rgb(var(--bg-surface) / 0.7) !important; }
	.dark .ui-card.ui-glass, .dark .ui-card.ui-glass-strong, .dark .ui-glass, .dark .ui-glass-strong { background-color: rgb(var(--bg-surface) / 0.8) !important; }
	.ui-glass .notif-row, .ui-glass .ui-btn, .ui-glass .ui-chip, .ui-glass .ui-field, .ui-glass .ui-segitem, .ui-glass-strong .notif-row, .ui-glass-strong .ui-btn, .ui-glass-strong .ui-chip, .ui-glass-strong .ui-field, .ui-glass-strong .ui-segitem { background-color: rgb(var(--bg-surface)); }

	/* Drawer helper */
	.ui-drawer { @apply ui-glass-strong shadow-elev-2 rounded-l-2xl; }

	/* Notification row layering */
	.notif-row { @apply relative isolate z-0; }
	.notif-row:hover, .notif-row:focus-within { @apply z-[20]; }

	/* Unread dot */
	.unread-dot { @apply inline-block h-2 w-2 rounded-full bg-[rgb(var(--accent))]; }

	/* ---- Notification card (mobile-first) ---- */
	.notif-card { @apply relative ui-card rounded-2xl p-4 sm:p-5 bg-[rgb(var(--bg-surface))] transition; }
	/* Light-only translucency for notification items */
	.notif-card { background-color: rgb(var(--bg-surface) / 0.8); }
	.dark .notif-card { background-color: rgb(var(--bg-surface)); }
	/* keyboard focus inside the card */
	.notif-card:focus-within { @apply ring-2 ring-[rgb(var(--accent))]; }
	/* drawer-selected row only */
	.notif-card[data-selected="true"] { @apply ring-1 ring-[rgb(var(--accent))]; }
	/* orange hint on hover (desktop only) */
	@media (hover: hover) {
		.notif-card:hover { @apply ring-1 ring-[rgb(var(--accent))]; }
	}

	.notif-head { @apply flex items-start gap-3; }
	.notif-title { @apply text-base sm:text-lg font-semibold leading-snug text-white; }
	.clamp-2 { display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }

	.meta-row { @apply text-xs mt-2 flex items-center gap-2 text-[rgb(var(--text-muted))] dark:text-white/60; }
	.meta-dot::before { content: '•'; @apply mx-1 text-[rgb(var(--text-muted))] dark:text-white/30; }

	.tags-row { @apply mt-3 flex gap-2 overflow-x-auto no-scrollbar; }
	.no-scrollbar::-webkit-scrollbar { display: none; }
	.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

	.open-cta { @apply ui-btn ui-iconbtn shrink-0 ml-auto; }

	@media (min-width: 640px) {
		.notif-title { @apply text-lg; }
		.meta-row { @apply text-[13px]; }
	}

	/* Explicit helpers for titles/meta using tokens */
	.notif-title { @apply text-[rgb(var(--text))]; }
	.notif-meta  { @apply text-[rgb(var(--text-muted))]; }
}

/* Light theme accessibility and contrast overrides */
html[data-theme="light"] {
	/* Make top navigation bar slightly grey and opaque for clarity */
	[data-topbar="true"] { background-color: rgb(var(--bg-subtle) / 0.95) !important; border-color: rgb(var(--border)) !important; box-shadow: 0 1px 0 rgba(0,0,0,0.06), 0 8px 24px rgba(0,0,0,0.05) !important; }
	/* Fix low-contrast utility classes used inside the details drawer */
	.text-white\/50 { color: rgb(var(--text-muted)) !important; }
	.border-white\/10 { border-color: rgb(var(--border)) !important; }
	.bg-white\/\[\.04\] { background-color: rgb(var(--bg-subtle)) !important; }
	.divide-white\/10 > :not([hidden]) ~ :not([hidden]) { border-color: rgb(var(--border)) !important; border-top-color: rgb(var(--border)) !important; }
}

@layer utilities {
	.no-scrollbar::-webkit-scrollbar { display: none; }
	.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
}
